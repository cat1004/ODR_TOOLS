<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.beiming.evidenceplatform.dao.HomeDataMapper">  <!-- 获取 委托标的物总数量 -->  <select id="getEntrustmentSum"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT COUNT(*) FROM corpore cp    <where>      <choose>        <when test="orgId != '' and orgId != null">          cp.org_id=#{orgId}        </when>        <when test="judgeId != null and judgeId != ''">          cp.service_per_id=#{judgeId}        </when>      </choose>    </where>  </select>  <!-- 获取 成交总金额 -->  <select id="getTransactionAmountSum"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT SUM(ad.auction_price) as transactionAmountSum    FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.status=130001      <choose>        <when test="orgId != '' and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and judgeId != ''">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>  </select>  <!-- 获取 成交总金额月环比-->  <select id="getMonthOnMonthBasisForPrice"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT ROUND((bSum-aSum)/aSum*100,2) as monthOnMonthBasisForPrice FROM    (SELECT SUM(ad.current_rate) as aSum FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.status=130003      <choose>        <when test="orgId != '' and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and judgeId != ''">          AND cp.service_per_id=#{judgeId}        </when>      </choose>      AND PERIOD_DIFF(DATE_FORMAT(NOW(),'%Y%m'),      DATE_FORMAT(cp.auction_time,'%Y%m')) =1    </where>    )lastMonth,    (SELECT SUM(ad.current_rate) as bSum FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.status=130003      <choose>        <when test="orgId != '' and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and judgeId != ''">          AND cp.service_per_id=#{judgeId}        </when>      </choose>      AND DATE_FORMAT(cp.auction_time,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m')    </where>    )thisMonth  </select>  <!-- 获取 去年按月分组的成交金额-->  <select id="getLastYearGroupByMonthEndPrice"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="com.beiming.evidenceplatform.domain.BaseGroupByMonthDTO">    SELECT month(cp.auction_time) as month,SUM(ad.current_rate) as groupByNum    FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      YEAR(cp.auction_time)=YEAR(DATE_SUB(NOW(),interval 1 YEAR))      <choose>        <when test="orgId != '' and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and judgeId != ''">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    GROUP BY MONTH (cp.auction_time)  </select>  <!-- 获取 今年按月分组的成交金额-->  <select id="getThisYearGroupByMonthEndPrice"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="com.beiming.evidenceplatform.domain.BaseGroupByMonthDTO">    SELECT month(cp.auction_time) as month,SUM(ad.current_rate) as groupByNum    FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      YEAR(cp.auction_time)=YEAR(NOW())      <choose>        <when test="orgId != '' and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and judgeId != ''">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    GROUP BY MONTH (cp.auction_time)  </select>  <!-- 获取 平均溢价率-->  <select id="getAveragePremiumRate"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT ROUND(sumPrice/sumCount*100,2) as averagePremiumRate FROM    (SELECT SUM((ad.current_rate-ad.auction_price)/ad.auction_price) as sumPrice    FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      ad.current_rate IS NOT NULL      <choose>        <when test="orgId != '' and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and judgeId != ''">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    )priceNum,    (SELECT COUNT(*) as sumCount FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      ad.current_rate IS NOT NULL      <choose>        <when test="orgId != '' and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and judgeId != ''">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    )lineNum  </select>  <!-- 获取 成交标的物总数量 -->  <select id="getDealCorporeSum"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT count(*) FROM corpore cp    <where>      cp.status=130003      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>  </select>  <!-- 获取 成交标的物总数量月环比-->  <select id="getMonthOnMonthBasisForVolume"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT ROUND((bCount-aCount)/aCount*100,2) as monthOnMonthBasisForVolume FROM    <!--上月成交量-->    (SELECT COUNT(*) as aCount FROM corpore cp    <where>      cp.status=130003      AND PERIOD_DIFF(DATE_FORMAT(NOW(),'%Y%m'),      DATE_FORMAT(cp.auction_time,'%Y%m')) =1      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    )lastMonth,    <!--本月成交量-->    (SELECT COUNT(*) as bCount FROM corpore cp    <where>      cp.status=130003      AND DATE_FORMAT(cp.auction_time,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m')      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    )thisMonth  </select>  <!-- 获取 去年按月分组的成交标的物数量 -->  <select id="getLastYearGroupByMonthCount"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="com.beiming.evidenceplatform.domain.BaseGroupByMonthDTO">    SELECT month(cp.auction_time) as month,COUNT(*) as groupByNum    FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      YEAR(cp.auction_time)=YEAR(DATE_SUB(NOW(),interval 1 YEAR))      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    GROUP BY MONTH (cp.auction_time)  </select>  <!-- 获取 今年按月分组的成交标的物数量 -->  <select id="getThisYearGroupByMonthCount"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="com.beiming.evidenceplatform.domain.BaseGroupByMonthDTO">    SELECT month(cp.auction_time) as month,COUNT(*) as groupByNum    FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      YEAR(cp.auction_time)=YEAR(NOW())      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    GROUP BY MONTH (cp.auction_time)  </select>  <!-- 获取 即将开拍的标的物总数量 -->  <select id="getSoonStartSum"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT count(*) FROM corpore cp    <where>      (cp.status=130001 OR cp.status=130002)      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>  </select>  <!-- 获取 流拍的标的物总数量 -->  <select id="getRacketSum"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT COUNT(*) FROM corpore cp    <where>      cp.status=130004      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>  </select>  <!-- 获取委托 标的物去年按月分组的数据-->  <select id="getLastYearForMonthCount"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="com.beiming.evidenceplatform.domain.CorporeCountByMonth">    SELECT month(cp.auction_time) as month,COUNT(*) as corporeCountByMonth FROM corpore cp    WHERE YEAR(cp.auction_time)=YEAR(DATE_SUB(NOW(),interval 1 YEAR))    GROUP BY MONTH (cp.auction_time)  </select>  <!-- 获取委托 标的物今年按月分组的数据-->  <select id="getThisYearForMonthCount"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="com.beiming.evidenceplatform.domain.CorporeCountByMonth">    SELECT month(cp.auction_time) as month,COUNT(*) as corporeCountByMonth FROM corpore cp    WHERE YEAR(cp.auction_time)=YEAR(NOW())    GROUP BY MONTH (cp.auction_time)  </select>  <!-- 获取委托 标的物月环比-->  <select id="getMonthOnMonthBasisForCount"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT ROUND((bCount-aCount)/aCount*100,2) as monthOnMonthBasisForCount FROM    (SELECT COUNT(*) as aCount FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      PERIOD_DIFF(DATE_FORMAT(NOW(),'%Y%m'),DATE_FORMAT(cp.auction_time,'%Y%m')) =1      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    )lastMonth,    (SELECT COUNT(*) as bCount FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      DATE_FORMAT(cp.auction_time,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m')      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    )thisMonth  </select>  <!-- 获取 公示期标的物总量 -->  <select id="getPublicCorporeSum"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT COUNT(*) FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.groundingtype=260001      AND ad.auction_url IS NOT NULL      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>  </select>  <!-- 获取公示期 标的物去年按月分组的数据-->  <select id="getLastYearForMonthPublic"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="com.beiming.evidenceplatform.domain.CorporeCountByMonth">    SELECT month(cp.auction_time) as month,COUNT(*) as corporeCountByMonth FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.groundingtype=260001      AND ad.auction_url IS NOT NULL      AND YEAR(cp.auction_time)=YEAR(DATE_SUB(NOW(),interval 1 YEAR))      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    GROUP BY MONTH (cp.auction_time)  </select>  <!-- 获取公示期 标的物今年按月分组的数据-->  <select id="getThisYearForMonthPublic"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="com.beiming.evidenceplatform.domain.CorporeCountByMonth">    SELECT month(cp.auction_time) as month,COUNT(*) as corporeCountByMonth FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.groundingtype=260001      AND ad.auction_url IS NOT NULL      AND YEAR(cp.auction_time)=YEAR(NOW())      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    GROUP BY MONTH (cp.auction_time)  </select>  <!-- 获取公示期 标的物月环比-->  <select id="getMonthOnMonthBasisForPublic"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT ROUND((bCount-aCount)/aCount*100,2) as monthOnMonthBasisForPublic FROM    (SELECT COUNT(*) as aCount FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.groundingtype=260001      AND ad.auction_url IS NOT NULL      AND PERIOD_DIFF(DATE_FORMAT(NOW(),'%Y%m'),      DATE_FORMAT(cp.auction_time,'%Y%m')) =1      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    )lastMonth,    (SELECT COUNT(*) as bCount FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.groundingtype=260001      AND ad.auction_url IS NOT NULL      AND DATE_FORMAT(cp.auction_time,'%Y%m')=DATE_FORMAT(CURDATE(),'%Y%m')      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>    )thisMonth  </select>  <!-- 获取 一拍标的物数量 -->  <select id="getOneBeatCount"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT COUNT(*) FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.status=130003      AND ad.auction_type=160000      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>  </select>  <!-- 获取 二拍标的物数量 -->  <select id="getSecondBeatCount"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT COUNT(*) FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.status=130003      AND ad.auction_type=160001      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>  </select>  <!-- 获取 变拍标的物总量 -->  <select id="getPatCount"    parameterType="com.beiming.evidenceplatform.domin.dto.requestdto.HomeDataRequestDTO"    resultType="string">    SELECT COUNT(*) FROM corpore cp    INNER JOIN corpore_house cph ON cph.corpore_id=cp.id    INNER JOIN auction_detail ad ON ad.corpore_house_id=cph.id    <where>      cp.status=130003      AND ad.auction_type=160002      <choose>        <when test="''!=orgId and orgId != null">          AND cp.org_id=#{orgId}        </when>        <when test="judgeId != null and ''!= judgeId">          AND cp.service_per_id=#{judgeId}        </when>      </choose>    </where>  </select></mapper>